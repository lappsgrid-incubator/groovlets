import src.main._private.ServiceHandler
import javax.servlet.http.HttpServletResponse

String method = request.method

String username = System.getenv('BRANDEIS_USERNAME')
String password = System.getenv('BRANDEIS_PASSWORD')
String url = 'http://eldrad.cs-i.brandeis.edu:8080/service_manager'

if (!username || !password) {
    response.status = HttpServletResponse.SC_INTERNAL_SERVER_ERROR
    html.html {
        head {
            title "Server Error"
        }
        body {
            h1 "500 Server Error"
            p "This service has not been properly configured"
        }
    }
    return
}

if (method != 'GET') {
    response.status = HttpServletResponse.SC_METHOD_NOT_ALLOWED
    response.addHeader('Allow', 'GET')
    html.html {
        head {
            title "Method Not Allowed"
        }
        body {
            h1 "405 Method Not Allowed"
            p "Only GET requests are supported."
        }
    }
    return
}

ServiceHandler handler = new ServiceHandler(this)
handler.url = url
handler.username = username
handler.password = password
handler.node = 'Brandeis'
handler.handle()

